# 医疗商保理赔场景下的隐私计算实验

## 实验目的
1. 了解数据跨域查询的原理与细节
2. 学会使用联邦学习进行模型训练
3. 了解同态加密技术

## 场景描述
目前，医疗健康的商业保险的理赔环节，需要保险用户自己提供的材料非常复杂。除了要提供申请人的身份证以外，还需要提供能支持索赔的全部账单、证明、信息和证据，比如病历资料、诊断书、处方、病理检查报告、化验检查报告、出院小结、医疗费用原始单据、费用明细单据等。同时整个过程需要人工上传相关的记录和证明材料，并且由保险公司进行线下核实，整个理赔流程环节繁琐、审核周期长，用户体验十分不友好。

为打通商保服务民生最后一公里，某市卫健委、市数据局、数据资产运营有限公司、保险公司等多方参与，共同探索开展线上快保核赔业务，该业务经个人授权同意后，利用卫健委已汇聚的医疗机构的诊疗记录、发生费用、电子病历等医疗数据信息，通过数据要素在不同主体之间的流通，实现在线理赔核保、理赔服务，同时探索开展普惠保险产品设计，为老百姓提供更多优质普惠的医保产品，实现“数据多跑路，群众少跑腿，商保更普惠”。

为了解决数据跨域流通的隐私保护、可信度等问题，我们需要针对特定任务，采用符合要求的数据可信流通技术。

## 数据说明
本项目数据集来自于四个主体：

1. `医院`，包括门诊数据、住院数据、检查数据、费用数据
2. `卫健委`，主要为医院基本信息、疾病描述信息
3. `人社局`，包括居民基本信息、医保参保信息、医保理赔结算数据
4. `保险公司`，包括商保产品数据、商保参保信息、商保理赔结算数据

数据保存在`data`文件夹中，更详细的数据信息介绍请参考`文件名`文件

## 实验要求
1. `基本要求`：按照步骤完成隐私计算的基本任务，最终生成实验报告文件，并附上必要的代码与运行测试结果
2. `拓展要求`：按照步骤提示，完成拓展任务

## 实验步骤
### 任务1：疾病基本信息与统计信息查询
为了设计保险产品的理赔金额，保险公司希望实现以下任务：已知一个疾病的名称，希望从数据中心获得该疾病的详细信息（疾病描述、疾病级别等），以及该疾病在过去一年的发病次数与平均诊治金额。

该任务需要进行跨域的数据查询，请模拟跨域查询的流程，分析出每个微服务上需要进行的查询任务（以查询树或查询流程图的形式展现出跨域查询时不同微服务的SQL查询任务）。

tip:受限于数据获取限制，本部分实验涉及到的数据(即医院主体数据与卫健委主体数据之间无法做到一一对应，请重点关注于元数据信息而非具体数据项)

### 任务2：医疗骗保预测模型训练
如何分析和预测医疗骗保行为是保险公司的重大问题，故各家保险公司想共同训练一个医疗骗保预测模型，但它们需要的患者病历诊断等信息被严限制在医疗机构与相关政府部门中，同时不同保险公司之间也不能直接分享自己掌握的信息。为解决这个问题，请使用`联邦学习`的相关技术方法来解决模型训练的问题。

本实验重点关注于联邦学习框架与流程，故对具体问题进行了简化处理。参与联邦学习的保险公司为A公司与B公司，它们拥有部分用于预测的特征项（年龄,性别,患病级别,诊疗天数,保险赔付金额,理赔处理时间,最近一年办理理赔次数）；政府部门则提供其他用于预测的特征项（是否有公共医疗保险,月收入），以及预测标签数据（即是否涉嫌保险欺诈）。预测模型可使用隐语混合联邦——逻辑回归模型，详见隐语平台使用手册。

请你使用隐语平台，运用联邦学习，设计一个设计保险公司A、保险公司B、政府部门共同训练的模型，并在测试集（testData.csv）上进行预测。

`拓展任务`，将公司单独进行训练（即只用某一个保险公司的数据和政府数据）、全量数据且直接合并进行训练、全量数据且使用联邦学习进行训练这三种方式进行比较，观察其在训练效果、训练时长、数据安全性等方面的差异，并尝试给出原因。

### 任务3：理赔金额计算
(`本任务为拓展选做任务`)为了保证患者信息不被泄露，政府相关部门与医院希望保证患者数据不出域（即不被保险公司所知）的情况下，保险公司即可计算得出理赔金额。

同态加密技术允许直接在密文数据上计算而无需先对其进行解密，并且得到的计算结果在解密之后与在明文数据上计算得到的结果相同。同时，本项任务只涉及简单的加减乘除的操作，故可以通过同态加密实现。请自行设计一种理赔金额计算方式（如按照不同的疾病级别，报销50%~80%不等的金额），并使用同态加密的算法进行理赔金额计算。